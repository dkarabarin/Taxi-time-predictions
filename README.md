# Прогнозирование заказов такси

## Описание проекта

Компания «Чётенькое такси» собрала исторические данные о заказах такси в аэропортах. Чтобы эффективно привлекать больше водителей в период пиковой нагрузки, необходим инструмент для прогнозирования количества заказов на следующий час.

**Цель проекта:** Построить модель машинного обучения для предсказания количества заказов такси на следующий час.

**Критерий успеха:** Значение метрики RMSE на тестовой выборке должно быть не более 48.

## Данные

Исходные данные содержатся в файле `taxi.csv` и включают в себя:
- `datetime` — дата и время заказа (индекс временного ряда).
- `num_orders` — количество заказов такси.

Период данных: с 1 марта по 31 августа 2018 года.

## Структура проекта

1.  **Загрузка и предобработка данных:** Ресемплирование данных по 1 часу для агрегации заказов.
2.  **Анализ данных (EDA):** Исследование трендов, сезонности и остатков временного ряда.
3.  **Feature Engineering:** Создание новых признаков (лагы, скользящее среднее, час, день недели, месяц).
4.  **Обучение моделей:** Сравнение нескольких моделей с подбором гиперпараметров с помощью `GridSearchCV` и кросс-валидации на временных рядах (`TimeSeriesSplit`).
5.  **Тестирование и выводы:** Оценка лучшей модели на тестовой выборке и анализ результатов.

## Используемые технологии и библиотеки

- **Python**
- **Pandas** / **NumPy** (работа с данными)
- **Scikit-learn** (модели, предобработка, метрики)
- **LightGBM** (градиентный бустинг)
- **Statsmodels** (сезонная декомпозиция)
- **Matplotlib** (визуализация)

## Установка и запуск

1.  Клонируйте репозиторий:
    ```bash
    git clone <URL вашего репозитория>
    ```
2.  Установите необходимые зависимости:
    ```bash
    pip install pandas scikit-learn lightgbm statsmodels matplotlib
    ```
3.  Запустите Jupyter Notebook или скрипт Python с кодом проекта.

## Краткое описание работы

### 1. Подготовка данных
- Данные загружаются, индекс преобразуется в `DateTimeIndex`.
- Выполняется ресемплирование по 1 часу с агрегацией суммы заказов (`data.resample('1H').sum()`).

### 2. Анализ данных
- Проверка на дубликаты.
- Сезонная декомпозиция (тренд, сезонность, остатки) выявила:
    - Общий восходящий тренд с марта по август.
    - Ярко выраженную суточную и недельную сезонность.
    - Повышенную волатильность остатков в августе.

### 3. Создание признаков
Сгенерированы дополнительные признаки для улучшения предсказательной силы моделей:
- **Лаговые признаки:** Количество заказов за предыдущие 1-10 часов (`lag_1...lag_10`).
- **Скользящее среднее:** Скользящее среднее за 10 часов (`rolling_mean`).
- **Временные признаки:** Час, день недели и месяц из временной метки.

### 4. Обучение моделей
Модели обучались и настраивались с использованием `GridSearchCV` и `TimeSeriesSplit` (3 сплита). Были протестированы:
- **RandomForestRegressor**
- **LGBMRegressor**
- **Ridge Regression** (с предварительной стандартизацией)

**Результаты на тренировочной выборке:**
- RandomForest: RMSE = 14.84
- LGBM: RMSE = 15.18
- Ridge: RMSE = 30.38

### 5. Тестирование и результаты
Лучшая модель (**RandomForest**) была протестирована на отложенной тестовой выборке (10% данных, последние 18 дней).

- **Итоговое значение RMSE на тесте: 45.49**
- Целевой показатель (RMSE < 48) **достигнут**.
- Анализ графика предсказаний показал, что модель хорошо улавливает общую динамику, хотя пиковые значения (спайки) предсказываются с ошибкой, что и вносит основной вклад в RMSE.
- Анализ важности признаков показал, что наибольший вклад в прогноз вносят лаговые признаки и час суток.

## Вывод

В рамках проекта была успешно разработана модель для прогнозирования часового спроса на заказы такси. Модель **RandomForest** демонстрирует удовлетворительное качество (RMSE = 45.49) и соответствует поставленному бизнес-требованию.

**Основные выводы:**
1.  Временной ряд обладает выраженной сезонностью, которую удалось capture с помощью feature engineering.
2.  Модели на основе ансамблей (Random Forest, LightGBM) показали себя значительно лучше линейной модели.
3.  Наибольшее влияние на прогноз оказывают недавние значения временного ряда (лаги) и время суток.

**Рекомендации для дальнейшего улучшения:**
- Экспериментировать с другими моделями (например, XGBoost, CatBoost).
- Использовать более сложные методы feature engineering (например, учет выходных/праздников).
- Реализовать прогноз с помощью специализированных моделей временных рядов (ARIMA, Prophet).
- Увеличить объем данных для обучения, включив информацию за более продолжительный период.
